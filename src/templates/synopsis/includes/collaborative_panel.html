{% if collaborative_enabled %}
<div class="border rounded bg-light p-3 mt-3">
    {% if collaborative_session %}
    <div class="d-flex flex-column flex-lg-row justify-content-between gap-3">
        <div>
            <div class="fw-semibold mb-1">Collaborative editing in progress</div>
            <div class="small text-muted">
                Started {{ collaborative_session.started_at|date:"Y-m-d H:i" }}
                {% if collaborative_session.started_by %}
                by {{ collaborative_session.started_by.get_full_name|default:collaborative_session.started_by.username }}
                {% endif %}
                {% if collaborative_session.last_activity_at %}
                Â· Last activity {{ collaborative_session.last_activity_at|date:"Y-m-d H:i" }}
                {% endif %}
            </div>
            {% if collaborative_session.last_participant_name %}
            <div class="small text-muted mt-1">Latest update by {{ collaborative_session.last_participant_name }}</div>
            {% endif %}
        </div>
        <div class="d-flex flex-wrap gap-2 align-items-center">
            {% if collaborative_resume_url %}
            <a class="btn btn-primary btn-sm" href="{{ collaborative_resume_url }}" target="_blank" rel="noopener">Open editor</a>
            {% endif %}
            {% if collaborative_can_override and collaborative_force_end_url %}
            <form method="post" action="{{ collaborative_force_end_url }}" class="d-inline" onsubmit="return confirm('End this collaborative session for everyone?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm">End session</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="d-flex flex-column flex-lg-row justify-content-between gap-3 align-items-start align-items-lg-center">
        <div>
            <div class="fw-semibold mb-1">Start a collaborative editing session</div>
            <div class="small text-muted">Launch OnlyOffice to edit the {{ document_label|lower }} with real-time co-authoring.</div>
        </div>
        <div class="d-flex gap-2 align-items-center">
            {% if can_edit_documents %}
            <form method="post" action="{{ collaborative_start_url }}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-primary btn-sm" formtarget="_blank">Start collaborative edit</button>
            </form>
            {% else %}
            <span class="small text-muted">You need edit access to start a collaborative session.</span>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endif %}
