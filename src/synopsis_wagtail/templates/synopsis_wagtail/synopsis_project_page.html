{% extends "synopsis/base.html" %}
{% load wagtailcore_tags %}

{% block title %}{{ page.title }}{% endblock %}

{% block content %}
<div class="bg-white p-4 rounded shadow-sm mb-4">
    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
        <div>
            <p class="text-uppercase text-muted small mb-1">Synopsis project</p>
            <h1 class="h3 mb-0">{{ page.project.title }}</h1>
        </div>
        <div class="text-muted small">
            Project ID: {{ page.project.id }}
        </div>
    </div>
    {% if page.introduction %}
        <hr>
        <div class="rich-text">
            {{ page.introduction|richtext }}
        </div>
    {% endif %}
</div>

<section class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="h5 mb-0">Chapters</h2>
        {% if request.user.is_authenticated %}
            <a class="btn btn-outline-primary btn-sm" href="{% url 'wagtailadmin_pages:add_subpage' page.id %}">Add chapter</a>
        {% endif %}
    </div>
    {% if page.get_children.exists %}
        <div class="list-group">
            {% for child in page.get_children.specific %}
            <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-start" href="{{ child.url }}">
                <div>
                    <div class="fw-semibold">{{ child.title }}</div>
                    {% if child.summary %}
                        <div class="text-muted small">{{ child.summary|striptags|truncatewords:30 }}</div>
                    {% endif %}
                </div>
                <span class="badge text-bg-light">{{ child.body|length }} sections</span>
            </a>
            {% empty %}
            <div class="list-group-item text-muted">No chapters have been created yet.</div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-secondary">No chapters have been created yet.</div>
    {% endif %}
</section>
{% endblock %}
